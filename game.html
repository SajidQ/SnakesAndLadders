<html>

    <head>
        
        <title>Snakes and Ladders Game</title>
        
        <link rel="stylesheet" type="text/css" href="game.css">
        
        <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js">
            
           
        </script>

    </head>

    <body>

        <div id="game_body">
            
            <div id="checkers">
                
                <div id="snake_and_ladder"><img src="images/snake_ladder1.png" height="490" ></div>
                <div id="snake1"><img src="images/snake1.png" height="160" ></div>
                <div id="snake2"><img src="images/snake2.png" height="70" ></div>
				<div id="snake3"><img src="images/snake3.png" height="200" ></div>
                <div id="ladder1"><img src="images/ladder1.png" height="170" ></div>
                <div id="ladder2"><img src="images/ladder2.png" height="130" ></div>
                <div id="ladder3"><img src="images/ladder3.png" height="180" ></div>
                <div id="ladder4"><img src="images/ladder4.png" height="110" ></div>
                
                <div id="red-piece"><img src="images/red-piece.png" height="40"></img></div>
                
                <div id="red-label">Computer</div>
                <div id="blue-piece"><img src="images/blue-piece.png" height="40"></img></div>
                <div id="blue-label">You</div>
                <div id="position">Position: X=0, y=0</div>
				<div id="dice"><img id="dice_img" src="images/side1.png" height="60"></div>
				<div id="turn">It's your turn. Click to roll the dice!</div>
            </div>
            
            <script>
                
                $(document).ready(function(){
								  
					 //GAME VARIABLES ///////////////////////////
                      var blue_piece_object = {
                          top: null,
                          left:null
					  }
								  
					  var snakes=[{start:'id_97',end:79}, {start:'id_81', end:18}, {start:'id_16', end:11}, {start:'id_76', end:46}];
					  var ladders=[{start:'id_6',end:29}, {start:'id_49', end:68}, {start:'id_21', end:86}, {start:'id_73', end:92}, {start:'id_30', end:40}];
						
						/*
					  var game_started=0; //// 0=game hasn't started; 1=game started
					  var whos_turn=1; //// 1=blue_piece; 0=computer
					  var blue_turn_text="It's your turn. Click to roll the dice!";
					  var computer_turn_text="It's the computer's turn";
					  var computer_location=-1;
					  var blue_location=-1;
					  var dice_results=0;
					  var allow_move=0;*/
						
					  var main_vars=[];
					  main_vars["game_started"]=0;
					  main_vars["whos_turn"]=1;
					  main_vars["blue_turn_text"]="It's your turn. Click to roll the dice!";
					  main_vars["computer_turn_text"]="It's the computer's turn";
					  main_vars["computer_location"]=-1;
					  main_vars["blue_location"]=-1;
					  main_vars["dice_results"]=0;
					  main_vars["allow_move"]=0;
								  
								  
					  //set up background
                      make_background();
					  
					 
						
					  ////////////////////////////////////////
					  // Mouse effects ///////////////////////////////
					  var $blue_piece = null;
					  
					  $(document.body).on("mousemove", function(e) {
						  if ($blue_piece) {
						  $blue_piece.offset({
											 top: e.pageY,
											 left: e.pageX
											 });
						  }
						  
						  if($blue_piece!==null)
						  {
							blue_piece_object.left=($blue_piece.offset().left);
							blue_piece_object.top=($blue_piece.offset().top);
										  
							$("#position").html("X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top));
						  }
						  
					  });
					  
					  $(document.body).on("mousedown", "#blue-piece", function (e) {
						  if(main_vars["whos_turn"]==1 && main_vars["allow_move"]==1)
						  {
							  $blue_piece = $(e.target);
							  
							  blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
							  blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
							  
							  
							  //debugging print out position of the blue piece
							  $("#position").html("X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top));
							 
							  
							  //get the location of the blue piece
							  var on_box=find_box($blue_piece);
							  
							  
							  if(on_box!==null)
							  {
									alert("On box: "+on_box);

									check_for_ladders_snakes(on_box,blue_piece_object, ladders,snakes,main_vars);

									//if the robot is on its correct location; change the player
									if(on_box==("id_"+main_vars["blue_location"]))
									{
										main_vars["whos_turn"]=0;
									    main_vars["allow_move"]=0;
										
										$("#position").html("ON: "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
										  
										  computers_turn(main_vars);
										  
										  $("#turn").html("It's the computer's turn.");
									}
									else
									{
										$("#position").html("NOT: "+on_box+" "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
									}
							  }
						  }
						  else
							  $("#position").html("allow_move: "+main_vars["allow_move"]+" blue: "+main_vars["blue_location"]);
					  });
					  
					  $(document.body).on("mouseup", function (e) {
						  $blue_piece = null;
						  
					  });

					  $(document.body).on("click", "#dice_img", function (e)
					  {
						  dice_roll(main_vars);
						  
					  });
								  
				 });
				 

				  function make_background()
				  {
						  var colors = ['be5553', 'bad6a5', 'e8b13b', '80CDC0', 'f2edbd'];
						  var colors_above = ['0','0','0','0','0','0','0','0','0','0'];
						  var colors_used=[0,0,0,0,0];
						  var color_num=0;
						  
						  //create the inner boxes
						  
						  //loop thorough all the boxes
						  var $newdiv;
						  
						  for (var i = 0; i < 100; i++) {
							  
							  //create a box class div and attach it to the checkers board
							  $newdiv = $('<div class="box" id="id_'+Math.abs(99-i)+'" />').text(Math.abs(99-i));
							  
							  $('#checkers').append($newdiv);
							  
							  $('#id_'+Math.abs(99-i)).css('background-color',"#"+colors[color_num]);
							  
							  //update color_num; mod if over 5
							  color_num++;
							  if(color_num>4)
								  color_num=color_num%5;
							  
							  //if finished with one row; move the colors
							  if((i+1)%10==0)
							  {
								  var first_col=colors[0];
								  var second_col=colors[1];
							  
								  for(var j=0; j<3; j++)
								  {
								  colors[j]=colors[(j+2)];
								  }
							  
								  colors[3]=first_col;
								  colors[4]=second_col;
							  }
						  }
				  }
							  

							  
				  function find_box($blue_piece)
				  {
					  var return_val=null;
					  var extra_space=4;
							  
					  //iterate through all the div boxes
					  $("div.box").each(function(index,value)
						{
							//$("#position").html("...X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top)+"\n id:"+value.id + " "+value.offsetLeft);
							//alert(index+ " "+value.id+" "+value.offsetLeft+" "+value.offsetWidth);
							
							
							var boxL=value.offsetLeft;
							var boxT=value.offsetTop;//-$("#checkers").offset().top;
							var boxWidth=value.offsetWidth;
							var pieceL=($blue_piece.offset().left-$("#checkers").offset().left);
							var pieceT=($blue_piece.offset().top-$("#checkers").offset().top);
							
							//alert(pieceL+">"+boxL+" && "+(pieceL+$blue_piece.width())+"<("+boxL+"+"+boxWidth+")");
							//alert(value.id+": "+boxT+"<"+pieceT+" && "+(boxT+boxWidth)+">="+(pieceT+$blue_piece.width()));
										
							if(pieceL>(boxL-extra_space) && (pieceL+$blue_piece.width())<=(boxL+boxWidth+extra_space))
								{
								if((boxT-extra_space)<pieceT && (boxT+boxWidth+extra_space)>=(pieceT+$blue_piece.width()))
								{
									//alert(value.id+": Collision");
									return_val=value.id;
								}
							}
						});
							  
					  return return_val;
				  }
			
				  function check_for_ladders_snakes(on_box,blue_piece_object, ladders, snakes, main_vars)
				  {
					  var new_location=0;
					  var ladder_or_snake=0;
					  for(var i=0;i<snakes.length; i++)
					  {
						  if(on_box==snakes[i].start)
						  {
							  alert("on snake:" +snakes[i].start);
							  
							  
								//slide down
								var snake_end=snakes[i].end;
								new_location=snake_end;
								ladder_or_snake=1;
								
								alert("id_"+snake_end+": "+$("#id_"+snake_end).offset().top+" "+$("#id_"+snake_end).offset().left);
								
								var blue_top=blue_piece_object.top;
								var blue_left=blue_piece_object.left
								var snake_top=$("#id_"+snake_end).offset().top-$("#checkers").offset().top;
								var snake_left=$("#id_"+snake_end).offset().left-$("#checkers").offset().left;
								
								var differce_left=snake_left-blue_left;
								var differce_top=snake_top-blue_top;
								alert("id_"+snake_end+": "+blue_top+" "+blue_left+" "+snake_top+" "+snake_left);
								alert("id_"+snake_end+": "+differce_top+" "+differce_left);
								
								$("#blue-piece").animate({
								 left:'+='+differce_left+'px',
								 top:'+='+differce_top+'px'
								 }, "slow");
						  }
						  
					  }
					  
					  for(var i=0;i<ladders.length; i++)
					  {
						  if(on_box==ladders[i].start)
						  {
							  alert("On stair:" +ladders[i].start);
							  
							  //slide down
							  var stair_end=ladders[i].end;
							  new_location=stair_end;
							  ladder_or_snake=1;
							  
							  alert("id_"+stair_end+": "+$("#id_"+stair_end).offset().top+" "+$("#id_"+stair_end).offset().left);
							  
							  var blue_top=blue_piece_object.top;
							  var blue_left=blue_piece_object.left
							  var stair_top=$("#id_"+stair_end).offset().top-$("#checkers").offset().top;
							  var stair_left=$("#id_"+stair_end).offset().left-$("#checkers").offset().left;
							  
							  var differce_left=stair_left-blue_left;
							  var differce_top=stair_top-blue_top;
							  alert("id_"+stair_end+": "+blue_top+" "+blue_left+" "+stair_top+" "+stair_left);
							  alert("id_"+stair_end+": "+differce_top+" "+differce_left);
							  
							  $("#blue-piece").animate({
								   left:'+='+differce_left+'px',
								   top:'+='+differce_top+'px'
							   }, "slow");
						  }
					  }
					  
					  if(ladder_or_snake==1)
					     main_vars["blue_location"]=new_location;
				  }
			
			
			
			
			
			      function dice_roll(main_vars){
						if(main_vars["whos_turn"]==1)
						   allow_move=1;

						j=Math.floor(Math.random()*6)+1;
						var time_out;
						var start=new Date().getTime();
						var intv=window.setInterval(function(){
							$('#dice_img').attr('src','images/side'+j+'.png');
							
							main_vars["dice_results"]=j;
								/*
							time_out=window.setTimeout(function(){
								window.clearInterval(intv);
								window.clearTimeout(time_out);
													   
								//$("#position").html("dice_roll: "+main_vars["dice_results"]);
								main_vars["allow_move"]=1;
													   
								if(main_vars["whos_turn"]==1)
									blue_pieces_turn(main_vars);
							    else
								    computers_turn(main_vars);
			   
							}, 10000);
								
							*/
							//get time
							var curr=new Date().getTime();
							if((curr-start)>10000)
							{
								window.clearInterval(intv);
								
								
								if(main_vars["whos_turn"]==1)
									blue_pieces_turn(main_vars);
								else
								    move_computer(main_vars);
							}
													
							j++; //increment data array id
							j=Math.floor(Math.random()*6)+1; //repeat from start
						
						},400);
						
						
				}
			
			
				function blue_pieces_turn(main_vars)
				{
					$("#turn").html("Move your piece "+main_vars["dice_results"]+" spots.");

					if(main_vars["blue_location"]==-1)
						main_vars["blue_location"]=0;
						
					main_vars["blue_location"]=main_vars["blue_location"]+main_vars["dice_results"];
					$("#position").html("blue_pieces_turn: "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
					
					main_vars["allow_move"]=1;
				}
			
			    function computers_turn(main_vars)
				{
					dice_roll(main_vars);
					move_computer(main_vars);
				}
			
			    function move_computer(main_vars)
				{
					//slide down
					var end_location=main_vars["dice_results"];
					new_location=end_location;
					ladder_or_snake=1;
					
					alert("id_"+end_location+": "+$("#id_"+end_location).offset().top+" "+$("#id_"+end_location).offset().left);
					
					var blue_top=$("#red-piece").offset().top;
					var blue_left=$("#red-piece").offset().left
					var new_loc_top=$("#id_"+end_location).offset().top-$("#checkers").offset().top;
					var new_loc_left=$("#id_"+end_location).offset().left-$("#checkers").offset().left;
					
					var differce_left=new_loc_left-blue_left;
					var differce_top=new_loc_top-blue_top;
					alert("id_"+end_location+": "+blue_top+" "+blue_left+" "+new_loc_top+" "+new_loc_left);
					alert("id_"+end_location+": "+differce_top+" "+differce_left);
					
					$("#red-piece").animate({
						 left:'+='+differce_left+'px',
						 top:'+='+differce_top+'px'
					 }, "slow");
					 
					 main_vars["whos_turn"]=1;
				}

            </script>
			
        </div>
        
        
    </body>


</html>
