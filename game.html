<html>

    <head>
        
        <title>Snakes and Ladders Game</title>
        
        <link rel="stylesheet" type="text/css" href="game.css">
        
        <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js">
            
           
        </script>

    </head>

    <body>

        <div id="game_body">
            
            <div id="checkers">
                
                <div id="snake_and_ladder"><img src="images/snake_ladder1.png" height="490" ></div>
                <div id="snake1"><img src="images/snake1.png" height="160" ></div>
                <div id="snake2"><img src="images/snake2.png" height="70" ></div>
				<div id="snake3"><img src="images/snake3.png" height="200" ></div>
                <div id="ladder1"><img src="images/ladder1.png" height="170" ></div>
                <div id="ladder2"><img src="images/ladder2.png" height="130" ></div>
                <div id="ladder3"><img src="images/ladder3.png" height="180" ></div>
                <div id="ladder4"><img src="images/ladder4.png" height="110" ></div>
                
                <div id="red-piece"><img src="images/red-piece.png" height="40"></img></div>
                
                <div id="red-label">Computer</div>
                <div id="blue-piece"><img src="images/blue-piece.png" height="40"></img></div>
                <div id="blue-label">You</div>
                <div id="position">Position: X=0, y=0</div>
				<div id="on_box">On Box: --</div>
				<div id="in_function">Function: --</div>
				<div id="computer">Function: --</div>
				<div id="dice"><img id="dice_img" src="images/side1.png" height="60"></div>
				<div id="turn">It's your turn. Click to roll the dice!</div>
            </div>
            
            <script>
                
                $(document).ready(function(){
								  
					 //GAME VARIABLES ///////////////////////////
                      var blue_piece_object = {
                          top: null,
                          left:null,
						  width:null
					  }
								  
					  var snakes=[{start:'id_98',end:80}, {start:'id_82', end:19}, {start:'id_17', end:12}, {start:'id_77', end:47}];
					  var ladders=[{start:'id_7',end:20}, {start:'id_50', end:69}, {start:'id_22', end:87}, {start:'id_74', end:93}, {start:'id_31', end:41}];
						
						
					  var main_vars=[];
					  main_vars["game_started"]=0;
					  main_vars["whos_turn"]=1; //1=player's turn, 0=computer's turn
					  main_vars["blue_turn_text"]="It's your turn. Click to roll the dice!";
					  main_vars["computer_turn_text"]="It's the computer's turn";
					  main_vars["computer_location"]=-1;
					  main_vars["blue_location"]=-1;
					  main_vars["dice_results"]=0;
					  main_vars["allow_move"]=0;
								  
								  
					  //set up background
                      make_background();
					  
					 
						
					  ////////////////////////////////////////
					  // Mouse effects ///////////////////////////////
					  var $blue_piece = null;
					  
					  $(document.body).on("mousemove", function(e) {
						  $("#in_function").html("mousemove");
										  
						  if ($blue_piece) {
						  $blue_piece.offset({
											 top: e.pageY,
											 left: e.pageX
											 });
						  }
						  
						  if($blue_piece!==null)
						  {
							blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
							blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
										  
							$("#position").html("X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top)+ ", L:"+main_vars["blue_location"]);
						  }
						  
					  });
					  
					  $(document.body).on("mousedown", "#blue-piece", function (e) {
										  
						  $("#in_function").html("mousedown");
										  
						  if(main_vars["allow_move"]==1)
						  {
							  $blue_piece = $(e.target);
							  //blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
							  //blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
							  //blue_piece_object.width=$blue_piece.width();
										  
							  update_blue_location($blue_piece, blue_piece_object);
											  
							  //debugging print out position of the blue piece
							  $("#position").html("X:"+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top)+ ", L:"+main_vars["blue_location"]);
											  
							  /*
							  if(main_vars["whos_turn"]==1 && main_vars["allow_move"]==1)
							  {
								  $blue_piece = $(e.target);
								  
								  blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
								  blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
								  blue_piece_object.width=$blue_piece.width();
								  
								  //debugging print out position of the blue piece
								  $("#position").html("X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top));
								 
							  }
							  else
								  $("#position").html("allow_move: "+main_vars["allow_move"]+" blue: "+main_vars["blue_location"]);
							   
							   */
						  }
						  else
							$("#in_function").html("mousedown: Not your turn.");
							
					  });
					  
					  $(document.body).on("mouseup", function (e) {
						  $("#in_function").html("mouseup");
										  
						  if(main_vars["allow_move"]==1)
						  {
							  //blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
							  //blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
							  //blue_piece_object.width=$blue_piece.width();
											  
							  update_blue_location($blue_piece, blue_piece_object);
									
							  //on_box=find_box($blue_piece);
							  var on_box=find_box(blue_piece_object);
										
							
							  var found_ladder=-1;
							  if(on_box==("id_"+main_vars["blue_location"]))
							      found_ladder=check_for_ladders_snakes(on_box,blue_piece_object, ladders,snakes,main_vars);
							  else
							      alert("Move to your correct spot!");
						  
							  if(found_ladder!==-1)
							  {
								  update_blue_location($blue_piece, blue_piece_object);
								  on_box=find_box(blue_piece_object);
							  }
										  
							  if(on_box==("id_"+main_vars["blue_location"]))
							  {
								 //debugging comment
								 $("#on_box").html("Box: "+on_box+ " on location!");
								 
								 //change turns
								 main_vars["allow_move"]=0;
							     main_vars["whos_turn"]=0;
								 $("#turn").html("It's the computer's turn.");
								  computers_turn(main_vars);
								 
								 $blue_piece = null;
							  }
							  else
							     alert("Move to your correct spot!");
						  }
						  else
							  $blue_piece = null;
										
						  $("#position").html("X:"+(blue_piece_object.left)+" , Y:"+(blue_piece_object.top)+ ", L:"+main_vars["blue_location"]);
										  
						  
						  
						  /*
						  if(main_vars["whos_turn"]==1 && main_vars["allow_move"]==1 && $blue_piece!==null)
						  {
							  blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
							  blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
							  blue_piece_object.width=$blue_piece.width();
										
										  
							  //get the location of the blue piece
							  var on_box=find_box(blue_piece_object);//$blue_piece);
										  
							  //debugging print out position of the blue piece
							  $("#position").html("X: "+($blue_piece.offset().left-$("#checkers").offset().left)+" , Y:"+($blue_piece.offset().top-$("#checkers").offset().top) + " On: " +on_box);
							  
							  if(on_box!==null)
							  {
								  check_for_ladders_snakes(on_box,blue_piece_object, ladders,snakes,main_vars);
								  
								  on_box=find_box($blue_piece);
										  
								  $("#on_box").html(on_box);
									
										  
								  //if the robot is on its correct location; change the player
								  if(on_box==("id_"+main_vars["blue_location"]))
								  {
									  main_vars["whos_turn"]=0;
									  
						   
									  
									  $("#position").html("ON: "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
									
									  $("#turn").html("It's the computer's turn.");
										  //computers_turn(main_vars);
								  }
								  else
								  {
									  $("#position").html("NOT: "+on_box+" "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
								  }
							  }
							  
						  }
						   */
						
						  
					  });

					  $(document.body).on("click", "#dice_img", function (e)
					  {
							 $("#in_function").html("dice_click");
						  dice_roll(main_vars);
						  
					  });
								  
				 });
				 

				  function make_background()
				  {
						  var colors = ['be5553', 'bad6a5', 'e8b13b', '80CDC0', 'f2edbd'];
						  var colors_above = ['0','0','0','0','0','0','0','0','0','0'];
						  var colors_used=[0,0,0,0,0];
						  var color_num=0;
						  
						  //create the inner boxes
						  
						  //loop thorough all the boxes
						  var $newdiv;
						  
						  for (var i = 0; i < 100; i++) {
							  
							  //create a box class div and attach it to the checkers board
							  $newdiv = $('<div class="box" id="id_'+(Math.abs(99-i)+1)+'" />').text(Math.abs(99-i)+1);
							  
							  $('#checkers').append($newdiv);
							  
							  $('#id_'+(Math.abs(99-i)+1)).css('background-color',"#"+colors[color_num]);
							  
							  //update color_num; mod if over 5
							  color_num++;
							  if(color_num>4)
								  color_num=color_num%5;
							  
							  //if finished with one row; move the colors
							  if((i+1)%10==0)
							  {
								  var first_col=colors[0];
								  var second_col=colors[1];
							  
								  for(var j=0; j<3; j++)
								  {
								  colors[j]=colors[(j+2)];
								  }
							  
								  colors[3]=first_col;
								  colors[4]=second_col;
							  }
						  }
				  }
							  

				  /*
				  function find_box($blue_piece)
				  {
					  $("#in_function").html("find_box");
					  var return_val=null;
					  var extra_space=4;
							  
					  //iterate through all the div boxes
					  $("div.box").each(function(index,value)
						{
							
							var boxL=value.offsetLeft;
							var boxT=value.offsetTop;//-$("#checkers").offset().top;
							var boxWidth=value.offsetWidth;
							var pieceL=($blue_piece.offset().left-$("#checkers").offset().left);
							var pieceT=($blue_piece.offset().top-$("#checkers").offset().top);
							//var pieceL=(blue_piece_object.left-$("#checkers").offset().left);
							//var pieceT=(blue_piece_object.top-$("#checkers").offset().top);
									
							if(pieceL>(boxL-extra_space) && (pieceL+$blue_piece.width())<=(boxL+boxWidth+extra_space))
								{
								if((boxT-extra_space)<pieceT && (boxT+boxWidth+extra_space)>=(pieceT+$blue_piece.width()))
								{
									alert(value.id+": Collision");
									return_val=value.id;
								}
							}
						});
						
					  if(return_val==null)
						  alert("find_box: error, box is null");
					  
					  return return_val;
				  }*/
			
				function find_box(blue_piece_object)
				{
					$("#in_function").html("find_box");
					var return_val=null;
					var extra_space=4;
					
					//iterate through all the div boxes
					$("div.box").each(function(index,value)
					  {
					  
						  var boxL=value.offsetLeft;
						  var boxT=value.offsetTop;//-$("#checkers").offset().top;
						  var boxWidth=value.offsetWidth;
						  var pieceL=blue_piece_object.left;
						  var pieceT=blue_piece_object.top;
						  //var pieceL=(blue_piece_object.left-$("#checkers").offset().left);
						  //var pieceT=(blue_piece_object.top-$("#checkers").offset().top);
						  
						  if(pieceL>(boxL-extra_space) && (pieceL+blue_piece_object.width)<=(boxL+boxWidth+extra_space))
						  {
							  if((boxT-extra_space)<pieceT && (boxT+boxWidth+extra_space)>=(pieceT+blue_piece_object.width))
							  {
								  //alert(value.id+": Collision");
								  
								  return_val=value.id;
								  $("#on_box").html("Box: "+return_val);
							  }
						  }
					  });
					  
					  if(return_val==null)
						  alert("Move to your correct spot!");
					  
					  return return_val;
				}
			
				  function check_for_ladders_snakes(on_box,blue_piece_object, ladders, snakes, main_vars)
				  {
					  $("#in_function").html("check_for_ladders_snakes");
					  //var new_location=0;
					  var the_end_location=-1;
					  var ladder_or_snake=0;
					  for(var i=0;i<snakes.length; i++)
					  {
						  if(on_box==snakes[i].start)
						  {
							  alert("on snake:" +snakes[i].start);
							  
								//slide down
								var snake_end=snakes[i].end;
								the_end_location=snake_end;
								
								//alert("id_"+snake_end+": "+$("#id_"+snake_end).offset().top+" "+$("#id_"+snake_end).offset().left);
								/*
								var blue_top=blue_piece_object.top;
								var blue_left=blue_piece_object.left
								var snake_top=$("#id_"+snake_end).offset().top-$("#checkers").offset().top;
								var snake_left=$("#id_"+snake_end).offset().left-$("#checkers").offset().left;
								
								var differce_left=snake_left-blue_left;
								var differce_top=snake_top-blue_top;
								//alert("id_"+snake_end+": "+blue_top+" "+blue_left+" "+snake_top+" "+snake_left);
								//alert("id_"+snake_end+": "+differce_top+" "+differce_left);
								
								$("#blue-piece").animate({
								 left:'+='+differce_left+'px',
								 top:'+='+differce_top+'px'
								 }, "slow");*/
						  }
						  
					  }
					  
					  for(var i=0;i<ladders.length; i++)
					  {
						  if(on_box==ladders[i].start)
						  {
							  alert("On stair:" +ladders[i].start);
							  
							  //slide down
							  var stair_end=ladders[i].end;
							  the_end_location=stair_end;
							  
							  //alert("id_"+stair_end+": "+$("#id_"+stair_end).offset().top+" "+$("#id_"+stair_end).offset().left);
							  /*
							  var blue_top=blue_piece_object.top;
							  var blue_left=blue_piece_object.left
							  var stair_top=$("#id_"+stair_end).offset().top-$("#checkers").offset().top;
							  var stair_left=$("#id_"+stair_end).offset().left-$("#checkers").offset().left;
							  
							  var differce_left=stair_left-blue_left;
							  var differce_top=stair_top-blue_top;
							  //alert("id_"+stair_end+": "+blue_top+" "+blue_left+" "+stair_top+" "+stair_left);
							  //alert("id_"+stair_end+": "+differce_top+" "+differce_left);
							  
							  $("#blue-piece").animate({
								   left:'+='+differce_left+'px',
								   top:'+='+differce_top+'px'
							   }, "slow");*/
						  }
					  }
					  
					  
					  if(the_end_location!==-1)
					  {
						  var blue_top=blue_piece_object.top;
						  var blue_left=blue_piece_object.left
						  var box_top=$("#id_"+the_end_location).offset().top-$("#checkers").offset().top;
						  var box_left=$("#id_"+the_end_location).offset().left-$("#checkers").offset().left;
						  
						  var differce_left=box_left-blue_left;
						  var differce_top=box_top-blue_top;
						  //alert("id_"+stair_end+": "+blue_top+" "+blue_left+" "+stair_top+" "+stair_left);
						  //alert("id_"+stair_end+": "+differce_top+" "+differce_left);
						  
						  $("#blue-piece").animate({
							   left:'+='+differce_left+'px',
							   top:'+='+differce_top+'px'
						   }, "slow");
						
					     main_vars["blue_location"]=the_end_location;
						 //blue_piece_object.top=$("#blue-piece").offset().top;
						 //blue_piece_object.left=$("#blue-piece").offset().left;
					  }
					  
					  return the_end_location;
				  }
			
			
			
			
			
			      function dice_roll(main_vars){
					    $("#in_function").html("dice_roll");
						
						j=Math.floor(Math.random()*6)+1;
						var time_out;
						var start=new Date().getTime();
						var intv=window.setInterval(function(){
							$('#dice_img').attr('src','images/side'+j+'.png');
							
							main_vars["dice_results"]=j;
								/*
							time_out=window.setTimeout(function(){
								window.clearInterval(intv);
								window.clearTimeout(time_out);
													   
								//$("#position").html("dice_roll: "+main_vars["dice_results"]);
								main_vars["allow_move"]=1;
													   
								if(main_vars["whos_turn"]==1)
									blue_pieces_turn(main_vars);
							    else
								    computers_turn(main_vars);
			   
							}, 10000);
								
							*/
							//get time
							var curr=new Date().getTime();
							if((curr-start)>10000)
							{
								window.clearInterval(intv);
								
								if(main_vars["whos_turn"]==1)
									blue_pieces_turn(main_vars);
								else if(main_vars["whos_turn"]==0)
								    move_computer(main_vars);
								 
							}
													
							j++; //increment data array id
							j=Math.floor(Math.random()*6)+1; //repeat from start
						
						},500);
						
						
				}
			
			
				function blue_pieces_turn(main_vars)
				{
					
					//update turn sign
					$("#turn").html("Move your piece "+main_vars["dice_results"]+" spots.");

                    //change location of blue_object if it was -1
					if(main_vars["blue_location"]==-1)
						main_vars["blue_location"]=0;
					
					//update the new blue location using dice roll
					main_vars["blue_location"]=main_vars["blue_location"]+main_vars["dice_results"];
					
					//allow the player to move to the new location
					main_vars["allow_move"]=1;
					
					//comments for debugging
					$("#in_function").html("blue_pieces_turn: "+main_vars["blue_location"]+" "+main_vars["allow_move"]);
				}
			
			    function computers_turn(main_vars)
				{
					$("#in_function").html("computers_turn");
					
					dice_roll(main_vars);
					
				}
			
			    function move_computer(main_vars)
				{
					//add wait?
					/*
					var start=new Date().getTime();
					var curr=new Date().getTime();
					while((curr-start)<10000)
					{
						curr=new Date().getTime();
					}*/
				
					$("#in_function").html("move_computer");
					
					//slide down
					var end_location=-1;
					
					if(main_vars["computer_location"]==-1)
						main_vars["computer_location"]=0;
						
					main_vars["computer_location"]=main_vars["computer_location"]+main_vars["dice_results"];
					end_location=main_vars["computer_location"];
					
					$("#in_function").html("move_computer");
					$("#computer").html("computer: "+end_location);
					
			//..alert("id_"+end_location+": "+$("#id_"+end_location).offset().top+" "+$("#id_"+end_location).offset().left);
					
					var blue_top=($("#red-piece").offset().top-$("#checkers").offset().top);
					var blue_left=($("#red-piece").offset().left-$("#checkers").offset().left);
					var new_loc_top=$("#id_"+end_location).offset().top-$("#checkers").offset().top;
					var new_loc_left=$("#id_"+end_location).offset().left-$("#checkers").offset().left;
					
					var differce_left=new_loc_left-blue_left;
					var differce_top=new_loc_top-blue_top;
					//alert("id_"+end_location+": "+blue_top+" "+blue_left+" "+new_loc_top+" "+new_loc_left);
					//alert("id_"+end_location+": "+differce_top+" "+differce_left);
					
					$("#red-piece").animate({
						 left:'+='+differce_left+'px',
						 top:'+='+differce_top+'px'
					 }, "slow");
					 
					 main_vars["whos_turn"]=1;
				}
			
			
			    function update_blue_location($blue_piece, blue_piece_object)
				{
					blue_piece_object.left=($blue_piece.offset().left-$("#checkers").offset().left);
					blue_piece_object.top=($blue_piece.offset().top-$("#checkers").offset().top);
					blue_piece_object.width=$blue_piece.width();
				}

            </script>
			
        </div>
        
        
    </body>


</html>
